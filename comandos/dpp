#!/bin/bash
# DPP Wrapper - Director of Pre-Processing
# Usage: comandos/dpp "instruction"

INSTRUCTION="$1"
PROMPT_PATH=".gemini/prompts/DPP_CORE.md"

if [ ! -f "$PROMPT_PATH" ]; then
  echo "Error: Prompt file not found at $PROMPT_PATH"
  exit 1
fi
PROJECT_ROOT="/home/cmr-auto/claude-work/repos/Claude-Code-Projetos"

if [ -z "$INSTRUCTION" ]; then
  echo "Usage: comandos/dpp \"instruction\""
  exit 1
fi

# Ensure we are at root for relative paths
cd "$PROJECT_ROOT"

# Construct the payload: System Prompt + Task
# Explicitly pass GEMINI_API_KEY to the gemini command
cat "$PROMPT_PATH" <(echo -e "\n\n=== TASK ===\n$INSTRUCTION") | GEMINI_API_KEY="$GEMINI_API_KEY" gemini
EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
  echo "Error: Gemini command failed with exit code $EXIT_CODE"
  exit $EXIT_CODE
fi
